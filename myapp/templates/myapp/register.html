{% extends 'myapp/base.html' %}

{% block title %}Register - Gizmo Survey{% endblock %}
{% block page_title %}Register{% endblock %}

{% block extra_css %}
<style>
    .register-container {
        min-height: 100vh;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        padding: 2rem 0;
    }

    .register-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="register-pattern" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="10" cy="60" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="90" cy="40" r="0.5" fill="rgba(255,255,255,0.05)"/></pattern></defs><rect width="100" height="100" fill="url(%23register-pattern)"/></svg>');
        opacity: 0.1;
    }

    .register-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-xl);
        width: 100%;
        max-width: 600px;
        position: relative;
        z-index: 10;
    }

    .register-header {
        text-align: center;
        padding: 2rem 2rem 1rem;
        border-bottom: 1px solid var(--border-light);
        position: relative;
    }

    .go-back-btn {
        position: absolute;
        top: 1rem;
        left: 1rem;
        background: none;
        border: 2px solid var(--border-medium);
        color: var(--text-secondary);
        padding: 0.5rem;
        border-radius: var(--radius-md);
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 2.5rem;
        height: 2.5rem;
        text-decoration: none;
    }

    .go-back-btn:hover {
        background: var(--bg-secondary);
        border-color: var(--primary-color);
        color: var(--primary-color);
        transform: translateX(-2px);
    }

    .go-back-btn i {
        font-size: 1rem;
    }

    .register-header h1 {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .register-header p {
        color: var(--text-muted);
        font-size: 0.95rem;
        margin: 0;
    }

    .register-body {
        padding: 2rem;
    }

    .form-floating {
        margin-bottom: 1.5rem;
    }

    .form-floating .form-control {
        border: 2px solid var(--border-light);
        border-radius: var(--radius-md);
        padding: 1rem;
        font-size: 0.95rem;
        background: var(--bg-primary);
        transition: all 0.3s ease;
        box-shadow: var(--shadow-sm);
        outline: none;
    }

    .form-floating .form-control:hover {
        border-color: var(--border-medium);
        box-shadow: var(--shadow-md);
    }

    .form-floating .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
    }

    .form-floating label {
        color: var(--text-secondary);
        font-weight: 500;
    }

    .form-select {
        border: 2px solid var(--border-light);
        border-radius: var(--radius-md);
        padding: 1rem;
        font-size: 0.95rem;
        background: var(--bg-primary);
        transition: all 0.3s ease;
        box-shadow: var(--shadow-sm);
        outline: none;
    }

    .form-select:hover {
        border-color: var(--border-medium);
        box-shadow: var(--shadow-md);
    }

    .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
    }

    .register-btn {
        width: 100%;
        padding: 1rem;
        font-size: 1rem;
        font-weight: 600;
        border-radius: var(--radius-md);
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        border: none;
        color: var(--text-white);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .register-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .register-btn:active {
        transform: translateY(0);
    }

    .divider {
        display: flex;
        align-items: center;
        margin: 1.5rem 0;
        color: var(--text-muted);
        font-size: 0.875rem;
    }

    .divider::before,
    .divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background: var(--border-light);
    }

    .divider span {
        padding: 0 1rem;
        background: var(--bg-primary);
    }

    .login-link {
        text-align: center;
        margin-top: 1.5rem;
    }

    .login-link a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.2s ease;
    }

    .login-link a:hover {
        color: var(--primary-dark);
        text-decoration: underline;
    }

    .field-group {
        display: flex;
        gap: 1rem;
    }

    .field-group .form-floating {
        flex: 1;
    }

    .error-message {
        color: var(--danger-color);
        font-size: 0.875rem;
        margin-top: 0.5rem;
        font-weight: 500;
    }

    /* Progress Indicator Styles */
    .progress-indicator {
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 2px solid var(--border-light);
    }

    .progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .progress-label {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.95rem;
    }

    .progress-percentage {
        font-weight: 700;
        color: var(--primary-color);
        font-size: 1.1rem;
    }

    .progress-bar-container {
        width: 100%;
        height: 8px;
        background: var(--bg-tertiary);
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 1rem;
    }

    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
        border-radius: 10px;
        transition: width 0.3s ease;
        width: 0%;
    }

    .progress-steps {
        display: flex;
        justify-content: space-between;
        gap: 0.5rem;
    }

    .progress-steps .step {
        flex: 1;
        text-align: center;
        padding: 0.5rem;
        font-size: 0.8rem;
        color: var(--text-muted);
        border-radius: var(--radius-sm);
        transition: all 0.3s ease;
    }

    .progress-steps .step.active {
        background: var(--primary-color);
        color: white;
        font-weight: 600;
    }

    .progress-steps .step.completed {
        background: var(--success-color);
        color: white;
    }

    /* Validation Feedback Styles */
    .form-floating {
        position: relative;
    }

    .validation-icon {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.2rem;
        pointer-events: none;
        transition: opacity 0.3s ease;
        z-index: 10;
    }

    .form-select.valid,
    .form-select.invalid {
        padding-right: 3rem;
    }

    .form-floating:has(.form-select) .validation-icon {
        top: 1.5rem;
    }

    .validation-icon.valid {
        color: var(--success-color);
    }

    .validation-icon.invalid {
        color: var(--danger-color);
    }

    .form-control.valid {
        border-color: var(--success-color);
        padding-right: 3rem;
    }

    .form-control.invalid {
        border-color: var(--danger-color);
        padding-right: 3rem;
    }

    .form-control:focus.valid {
        box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
    }

    .form-control:focus.invalid {
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }

    .password-strength {
        margin-top: 0.5rem;
        font-size: 0.8rem;
    }

    .password-strength-bar {
        height: 4px;
        background: var(--bg-tertiary);
        border-radius: 2px;
        margin-top: 0.25rem;
        overflow: hidden;
    }

    .password-strength-fill {
        height: 100%;
        transition: all 0.3s ease;
        border-radius: 2px;
    }

    .password-strength.weak .password-strength-fill {
        width: 33%;
        background: var(--danger-color);
    }

    .password-strength.medium .password-strength-fill {
        width: 66%;
        background: #f59e0b;
    }

    .password-strength.strong .password-strength-fill {
        width: 100%;
        background: var(--success-color);
    }

    .password-match {
        margin-top: 0.5rem;
        font-size: 0.8rem;
        display: none;
    }

    .password-match.show {
        display: block;
    }

    .password-match.match {
        color: var(--success-color);
    }

    .password-match.mismatch {
        color: var(--danger-color);
    }

    .floating-shapes {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 1;
    }

    .shape {
        position: absolute;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        animation: float 6s ease-in-out infinite;
    }

    .shape:nth-child(1) {
        width: 80px;
        height: 80px;
        top: 20%;
        left: 10%;
        animation-delay: 0s;
    }

    .shape:nth-child(2) {
        width: 120px;
        height: 120px;
        top: 60%;
        right: 15%;
        animation-delay: 2s;
    }

    .shape:nth-child(3) {
        width: 60px;
        height: 60px;
        bottom: 20%;
        left: 20%;
        animation-delay: 4s;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(180deg); }
    }

    @media (max-width: 768px) {
        .register-card {
            margin: 1rem;
            max-width: none;
        }
        
        .register-header,
        .register-body {
            padding: 1.5rem;
        }
        
        .field-group {
            flex-direction: column;
            gap: 0;
        }

        .go-back-btn {
            top: 0.75rem;
            left: 0.75rem;
            width: 2.25rem;
            height: 2.25rem;
            padding: 0.4rem;
            font-size: 0.85rem;
        }
    }
</style>
{% endblock %}

{% block public_content %}
<div class="register-container">
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>
    
    <div class="register-card">
        <div class="register-header">
            <a href="{% url 'home' %}" class="go-back-btn" onclick="event.preventDefault(); history.back();" title="Go Back">
                <i class="bi bi-arrow-left"></i>
            </a>
            <h1>Create Student Account</h1>
            <p>Join our survey management platform as a student</p>
        </div>
        
        <div class="register-body">
            <!-- Progress Indicator -->
            <div class="progress-indicator">
                <div class="progress-header">
                    <span class="progress-label">Form Progress</span>
                    <span class="progress-percentage" id="progressPercentage">0%</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="progress-steps">
                    <span class="step" id="step1">Personal Info</span>
                    <span class="step" id="step2">Account Details</span>
                    <span class="step" id="step3">Security</span>
                </div>
            </div>

            <form method="post" novalidate id="registrationForm">
                {% csrf_token %}
                
                <div class="field-group">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="{{ form.first_name.id_for_label }}" 
                               name="{{ form.first_name.name }}" placeholder="First Name" required>
                        <label for="{{ form.first_name.id_for_label }}">First Name</label>
                        <span class="validation-icon" id="first_name_icon"></span>
                        {% if form.first_name.errors %}
                            <div class="error-message">{{ form.first_name.errors.0 }}</div>
                        {% endif %}
                    </div>
                    <div class="form-floating">
                        <input type="text" class="form-control" id="{{ form.last_name.id_for_label }}" 
                               name="{{ form.last_name.name }}" placeholder="Last Name" required>
                        <label for="{{ form.last_name.id_for_label }}">Last Name</label>
                        <span class="validation-icon" id="last_name_icon"></span>
                        {% if form.last_name.errors %}
                            <div class="error-message">{{ form.last_name.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="form-floating">
                    <input type="text" class="form-control" id="{{ form.username.id_for_label }}" 
                           name="{{ form.username.name }}" placeholder="Username" required>
                    <label for="{{ form.username.id_for_label }}">Username</label>
                    <span class="validation-icon" id="username_icon"></span>
                    {% if form.username.errors %}
                        <div class="error-message">{{ form.username.errors.0 }}</div>
                    {% endif %}
                    <div class="error-message" id="username_error" style="display: none;"></div>
                </div>

                <div class="form-floating">
                    <input type="email" class="form-control" id="{{ form.email.id_for_label }}" 
                           name="{{ form.email.name }}" placeholder="Email" required>
                    <label for="{{ form.email.id_for_label }}">Email</label>
                    <span class="validation-icon" id="email_icon"></span>
                    {% if form.email.errors %}
                        <div class="error-message">{{ form.email.errors.0 }}</div>
                    {% endif %}
                    <div class="error-message" id="email_error" style="display: none;"></div>
                </div>

                <div class="form-floating">
                    <select class="form-select" id="{{ form.section.id_for_label }}" name="{{ form.section.name }}" required>
                        {% for value, label in form.section.field.choices %}
                            <option value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
                    <label for="{{ form.section.id_for_label }}">Section</label>
                    <span class="validation-icon" id="section_icon"></span>
                    {% if form.section.errors %}
                        <div class="error-message">{{ form.section.errors.0 }}</div>
                    {% endif %}
                </div>

                <div class="form-floating">
                    <input type="text" class="form-control" id="{{ form.student_id.id_for_label }}" 
                           name="{{ form.student_id.name }}" placeholder="Student ID" required>
                    <label for="{{ form.student_id.id_for_label }}">Student ID</label>
                    <span class="validation-icon" id="student_id_icon"></span>
                    {% if form.student_id.errors %}
                        <div class="error-message">{{ form.student_id.errors.0 }}</div>
                    {% endif %}
                </div>

                <div class="field-group">
                    <div class="form-floating">
                        <input type="password" class="form-control" id="{{ form.password1.id_for_label }}" 
                               name="{{ form.password1.name }}" placeholder="Password" required>
                        <label for="{{ form.password1.id_for_label }}">Password</label>
                        <span class="validation-icon" id="password1_icon"></span>
                        {% if form.password1.errors %}
                            <div class="error-message">{{ form.password1.errors.0 }}</div>
                        {% endif %}
                        <div class="password-strength" id="password_strength" style="display: none;">
                            <span id="strength_text">Password strength: </span>
                            <div class="password-strength-bar">
                                <div class="password-strength-fill"></div>
                            </div>
                        </div>
                    </div>
                    <div class="form-floating">
                        <input type="password" class="form-control" id="{{ form.password2.id_for_label }}" 
                               name="{{ form.password2.name }}" placeholder="Confirm Password" required>
                        <label for="{{ form.password2.id_for_label }}">Confirm Password</label>
                        <span class="validation-icon" id="password2_icon"></span>
                        {% if form.password2.errors %}
                            <div class="error-message">{{ form.password2.errors.0 }}</div>
                        {% endif %}
                        <div class="password-match" id="password_match">
                            <span id="match_text"></span>
                        </div>
                    </div>
                </div>

                <button type="submit" class="register-btn">
                    <span>Create Account</span>
                </button>
            </form>

            <div class="divider">
                <span>or</span>
            </div>

            <div class="login-link">
                <p class="mb-0">Already have an account? 
                    <a href="{% url 'login' %}">Sign in here</a>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
// Form validation and progress tracking
(function() {
    const form = document.getElementById('registrationForm');
    const progressBar = document.getElementById('progressBar');
    const progressPercentage = document.getElementById('progressPercentage');
    
    // Define all form fields
    const fields = {
        first_name: document.getElementById('{{ form.first_name.id_for_label }}'),
        last_name: document.getElementById('{{ form.last_name.id_for_label }}'),
        username: document.getElementById('{{ form.username.id_for_label }}'),
        email: document.getElementById('{{ form.email.id_for_label }}'),
        section: document.getElementById('{{ form.section.id_for_label }}'),
        student_id: document.getElementById('{{ form.student_id.id_for_label }}'),
        password1: document.getElementById('{{ form.password1.id_for_label }}'),
        password2: document.getElementById('{{ form.password2.id_for_label }}')
    };

    // Validation functions
    function validateFirstName(value) {
        return value.trim().length >= 2 && /^[a-zA-Z\s'-]+$/.test(value);
    }

    function validateLastName(value) {
        return value.trim().length >= 2 && /^[a-zA-Z\s'-]+$/.test(value);
    }

    function validateUsername(value) {
        return value.trim().length >= 3 && /^[a-zA-Z0-9_]+$/.test(value);
    }

    function validateEmail(value) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(value);
    }

    function validateSection(value) {
        return value && value !== '';
    }

    function validateStudentId(value) {
        return value.trim().length >= 3;
    }

    function validatePassword(value) {
        return value.length >= 8;
    }

    function checkPasswordStrength(password) {
        let strength = 0;
        if (password.length >= 8) strength++;
        if (password.length >= 12) strength++;
        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
        if (/\d/.test(password)) strength++;
        if (/[^a-zA-Z\d]/.test(password)) strength++;
        
        if (strength <= 2) return 'weak';
        if (strength <= 3) return 'medium';
        return 'strong';
    }

    function updateFieldValidation(fieldId, isValid, iconId, errorId = null) {
        const field = fields[fieldId];
        const icon = document.getElementById(iconId);
        
        if (!field || !icon) return;
        
        if (field.value.trim() === '') {
            field.classList.remove('valid', 'invalid');
            icon.textContent = '';
            icon.className = 'validation-icon';
            if (errorId) {
                const errorEl = document.getElementById(errorId);
                if (errorEl) errorEl.style.display = 'none';
            }
            return;
        }
        
        if (isValid) {
            field.classList.remove('invalid');
            field.classList.add('valid');
            icon.textContent = '✓';
            icon.className = 'validation-icon valid';
            if (errorId) {
                const errorEl = document.getElementById(errorId);
                if (errorEl) errorEl.style.display = 'none';
            }
        } else {
            field.classList.remove('valid');
            field.classList.add('invalid');
            icon.textContent = '✗';
            icon.className = 'validation-icon invalid';
        }
    }

    function updatePasswordStrength() {
        const password = fields.password1.value;
        const strengthDiv = document.getElementById('password_strength');
        const strengthText = document.getElementById('strength_text');
        
        if (password.length === 0) {
            strengthDiv.style.display = 'none';
            return;
        }
        
        strengthDiv.style.display = 'block';
        const strength = checkPasswordStrength(password);
        strengthDiv.className = `password-strength ${strength}`;
        
        const strengthLabels = {
            weak: 'Weak',
            medium: 'Medium',
            strong: 'Strong'
        };
        strengthText.textContent = `Password strength: ${strengthLabels[strength]}`;
    }

    function checkPasswordMatch() {
        const password1 = fields.password1.value;
        const password2 = fields.password2.value;
        const matchDiv = document.getElementById('password_match');
        const matchText = document.getElementById('match_text');
        
        if (password2.length === 0) {
            matchDiv.classList.remove('show');
            return;
        }
        
        matchDiv.classList.add('show');
        if (password1 === password2 && password1.length > 0) {
            matchDiv.classList.remove('mismatch');
            matchDiv.classList.add('match');
            matchText.textContent = '✓ Passwords match';
        } else {
            matchDiv.classList.remove('match');
            matchDiv.classList.add('mismatch');
            matchText.textContent = '✗ Passwords do not match';
        }
    }

    function calculateProgress() {
        let completed = 0;
        const total = Object.keys(fields).length;
        
        Object.keys(fields).forEach(fieldId => {
            const field = fields[fieldId];
            if (!field) return;
            
            let isValid = false;
            const value = field.value.trim();
            
            if (fieldId === 'first_name') {
                isValid = validateFirstName(value);
            } else if (fieldId === 'last_name') {
                isValid = validateLastName(value);
            } else if (fieldId === 'username') {
                isValid = validateUsername(value);
            } else if (fieldId === 'email') {
                isValid = validateEmail(value);
            } else if (fieldId === 'section') {
                isValid = validateSection(value);
            } else if (fieldId === 'student_id') {
                isValid = validateStudentId(value);
            } else if (fieldId === 'password1') {
                isValid = validatePassword(value);
            } else if (fieldId === 'password2') {
                isValid = validatePassword(value) && value === fields.password1.value;
            }
            
            if (isValid) completed++;
        });
        
        const percentage = Math.round((completed / total) * 100);
        progressBar.style.width = percentage + '%';
        progressPercentage.textContent = percentage + '%';
        
        // Update step indicators
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        
        const personalInfoComplete = validateFirstName(fields.first_name.value) && 
                                     validateLastName(fields.last_name.value) &&
                                     validateStudentId(fields.student_id.value) &&
                                     validateSection(fields.section.value);
        
        const accountComplete = validateUsername(fields.username.value) && 
                               validateEmail(fields.email.value);
        
        const securityComplete = validatePassword(fields.password1.value) && 
                                fields.password1.value === fields.password2.value;
        
        step1.classList.toggle('completed', personalInfoComplete);
        step2.classList.toggle('completed', accountComplete);
        step3.classList.toggle('completed', securityComplete);
        
        step1.classList.toggle('active', !personalInfoComplete && (fields.first_name.value || fields.last_name.value));
        step2.classList.toggle('active', personalInfoComplete && !accountComplete && (fields.username.value || fields.email.value));
        step3.classList.toggle('active', personalInfoComplete && accountComplete && !securityComplete);
    }

    // Add event listeners
    fields.first_name.addEventListener('input', function() {
        updateFieldValidation('first_name', validateFirstName(this.value), 'first_name_icon');
        calculateProgress();
    });

    fields.last_name.addEventListener('input', function() {
        updateFieldValidation('last_name', validateLastName(this.value), 'last_name_icon');
        calculateProgress();
    });

    fields.username.addEventListener('input', function() {
        const isValid = validateUsername(this.value);
        updateFieldValidation('username', isValid, 'username_icon', 'username_error');
        if (!isValid && this.value.trim().length > 0) {
            const errorEl = document.getElementById('username_error');
            if (errorEl) {
                errorEl.textContent = 'Username must be at least 3 characters and contain only letters, numbers, and underscores';
                errorEl.style.display = 'block';
            }
        }
        calculateProgress();
    });

    fields.email.addEventListener('input', function() {
        const isValid = validateEmail(this.value);
        updateFieldValidation('email', isValid, 'email_icon', 'email_error');
        if (!isValid && this.value.trim().length > 0) {
            const errorEl = document.getElementById('email_error');
            if (errorEl) {
                errorEl.textContent = 'Please enter a valid email address';
                errorEl.style.display = 'block';
            }
        }
        calculateProgress();
    });

    fields.section.addEventListener('change', function() {
        const isValid = validateSection(this.value);
        updateFieldValidation('section', isValid, 'section_icon');
        // Update select field classes
        if (isValid) {
            this.classList.remove('invalid');
            this.classList.add('valid');
        } else {
            this.classList.remove('valid');
            this.classList.add('invalid');
        }
        calculateProgress();
    });

    fields.student_id.addEventListener('input', function() {
        updateFieldValidation('student_id', validateStudentId(this.value), 'student_id_icon');
        calculateProgress();
    });

    fields.password1.addEventListener('input', function() {
        updateFieldValidation('password1', validatePassword(this.value), 'password1_icon');
        updatePasswordStrength();
        checkPasswordMatch();
        calculateProgress();
    });

    fields.password2.addEventListener('input', function() {
        const isValid = validatePassword(this.value) && this.value === fields.password1.value;
        updateFieldValidation('password2', isValid, 'password2_icon');
        checkPasswordMatch();
        calculateProgress();
    });

    // Initial progress calculation
    calculateProgress();
    
    // Form submission validation
    form.addEventListener('submit', function(e) {
        let isValid = true;
        
        if (!validateFirstName(fields.first_name.value)) isValid = false;
        if (!validateLastName(fields.last_name.value)) isValid = false;
        if (!validateUsername(fields.username.value)) isValid = false;
        if (!validateEmail(fields.email.value)) isValid = false;
        if (!validateSection(fields.section.value)) isValid = false;
        if (!validateStudentId(fields.student_id.value)) isValid = false;
        if (!validatePassword(fields.password1.value)) isValid = false;
        if (fields.password1.value !== fields.password2.value) isValid = false;
        
        if (!isValid) {
            e.preventDefault();
            alert('Please fill in all fields correctly before submitting.');
            return false;
        }
    });
})();
</script>
{% endblock %}
